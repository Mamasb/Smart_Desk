<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Fee Statement - {{ student.first_name }} {{ student.middle_name }}</title>
    <link rel="stylesheet" type="text/css" href="/static/css/style.css">
    <style>
        /* Styling for buttons */
        .invoice-footer button {
            margin: 10px 5px;
            padding: 10px 20px;
            background-color: #4CAF50;
            color: white;
            border: none;
            cursor: pointer;
            font-size: 14px;
        }
        .invoice-footer button:hover {
            background-color: #45a049;
        }
        .editable {
            border: 1px solid #ddd;
            padding: 5px;
        }

        /* Print-specific CSS to hide buttons */
        @media print {
            .invoice-footer button {
                display: none;
            }
        }

        /* Styling for the comment section */
        .comment-section {
            margin-top: 20px;
        }
        .comment-section textarea {
            width: 100%;
            height: 100px;
            border: 1px solid #ddd;
            padding: 10px;
            font-size: 14px;
        }
    </style>
</head>
<body>
    <div class="invoice-container">
        <!-- Invoice Header -->
        <div class="invoice-header">
            <div class="school-info">
                <h1>Adams Junior Academy</h1>
                <h3>PO Box 179-01100, Kajiado</h3>
                <h3>Phone: +254 0712674789</h3>
                <h3>Email: adamsjunioracademy@gmail.com</h3>
            </div>
            <h2>Fee Statement for {{ student.first_name }} {{ student.middle_name }}</h2>
            <h2><strong>Admission Number:</strong> {{ student.admission_number }}</h2>
            <h2><strong>Grade:</strong> {{ student.grade }}</h2>
        </div>

        <!-- Fee Breakdown -->
        <div class="invoice-details">
            <h3>Fee Breakdown</h3>
            <table id="fee-table">
                <thead>
                    <tr>
                        <th>Description</th>
                        <th>Amount (KSH)</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td>Tuition Fee ({{ student.grade }})</td>
                        <td class="editable" contenteditable="true">
                            {% if student.grade == 'Playgroup' %} 6500
                            {% elif student.grade in ['Grade1', 'Grade2', 'Grade3'] %} 8500
                            {% elif student.grade in ['Grade4', 'Grade5', 'Grade6'] %} 9000
                            {% elif student.grade in ['Grade7', 'Grade8', 'Grade9'] %} 12000
                            {% else %} 0 {% endif %}
                        </td>
                    </tr>
                    <tr>
                        <td>Activity Fee</td>
                        <td class="editable" contenteditable="true">200</td>
                    </tr>
                    <tr>
                        <td>School Diary</td>
                        <td class="editable" contenteditable="true">150</td>
                    </tr>
                    <tr>
                        <td>Exercise Books</td>
                        <td class="editable" contenteditable="true">
                            {{ 1500 if student.exercise_books_fee == "yearly" else 500 }}
                        </td>
                    </tr>
                    <tr>
                        <td>Transport</td>
                        <td class="editable" contenteditable="true">
                            {% if student.transport_mode == 'OneWay' %} 4500
                            {% elif student.transport_mode == 'TwoWayTown' %} 7000
                            {% elif student.transport_mode == 'TwoWayUma' %} 8000
                            {% else %} 0 {% endif %}
                        </td>
                    </tr>
                </tbody>
            </table>

            <!-- Total Fee Calculation -->
            <hr>
            <p><strong>Total Fee:</strong> KSH <span id="total-fee">0</span></p>
            <p><strong>Amount Paid:</strong> KSH <span id="amount-paid" contenteditable="true">{{ student.amount_paid or 0 }}</span></p>
            <p><strong>Balance:</strong> KSH <span id="balance">0</span></p>
        </div>
		        <h1>Payment Method</h1>
				<p><strong> Lipa na MPESA  paybill</strong>: 111999 </p>		
				<p><strong> Account Number</strong>: 200411  # admission number </p>
				<h1>Bank Deposit</h1>
				<p><strong> Sidian Bank Account Number</strong>: 01029150013477 </p>		
				<p><strong>NB: KIndly use pupil's Grade Full names and admission number  </strong></p>

        <!-- Comment Section -->
        <div class="comment-section">
            <label for="invoice-comment">Comment:</label>
            <textarea id="invoice-comment" placeholder="Add any comments here..."></textarea>
        </div>
		


        <!-- Invoice Footer with Buttons -->
        <div class="invoice-footer">
            <button id="edit-button" onclick="toggleEditMode()">Edit Invoice</button>
            <button id="save-button" onclick="saveInvoice()">Save Invoice</button>
            <button onclick="window.print()">Print Invoice</button>
            <button onclick="downloadInvoice()">Download Invoice as PDF</button>
        </div>
    </div>

    <script>
        function calculateTotals() {
            const rows = document.querySelectorAll("#fee-table tbody tr");
            let totalFee = 0;
            rows.forEach(row => {
                const amountCell = row.querySelector("td:last-child");
                const amount = parseFloat(amountCell.textContent.trim()) || 0;
                totalFee += amount;
            });
            const amountPaid = parseFloat(document.getElementById("amount-paid").textContent.trim()) || 0;
            const balance = totalFee - amountPaid;

            document.getElementById("total-fee").textContent = totalFee.toFixed(2);
            document.getElementById("balance").textContent = balance.toFixed(2);
        }

        function toggleEditMode() {
            const editableCells = document.querySelectorAll(".editable");
            editableCells.forEach(cell => {
                cell.setAttribute("contenteditable", "true");
                cell.style.backgroundColor = "#f9f9f9";
            });

            const amountPaidCell = document.getElementById("amount-paid");
            amountPaidCell.setAttribute("contenteditable", "true");
            amountPaidCell.style.backgroundColor = "#f9f9f9";
            
            calculateTotals();
        }

        function saveInvoice() {
            const editableCells = document.querySelectorAll(".editable");
            editableCells.forEach(cell => {
                cell.setAttribute("contenteditable", "false");
                cell.style.backgroundColor = "transparent";
            });

            const amountPaidCell = document.getElementById("amount-paid");
            amountPaidCell.setAttribute("contenteditable", "false");
            amountPaidCell.style.backgroundColor = "transparent";

            calculateTotals();
            alert("Invoice saved successfully!");
        }

        function downloadInvoice() {
            window.open('/download_invoice/{{ student.id }}', '_blank');
        }

        document.querySelectorAll(".editable").forEach(cell => {
            cell.addEventListener("input", calculateTotals);
        });

        document.getElementById("amount-paid").addEventListener("input", calculateTotals);

        calculateTotals();
    </script>
</body>
</html>
